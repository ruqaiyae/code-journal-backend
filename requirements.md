# Code Journal Backend Requirements

## Data Model

The codeJournal database has one table named `entries` with these fields:

- `entryId`: The numerical ID of the entry, auto-generated by PostgreSQL
- `title`: The entry's title
- `notes`: Notes for the entry
- `photoUrl`: The URL of a photo for the entry

## Data Storage and Retrieval

The React client must read the entries from the database.

Each time the user creates, edits, or deletes an entry, the change must be reflected in the database.

If the React app is reloaded, it must reflect the most recent state of the entries in the database.

## Error Handling

If errors occur while interacting with the backend, they must be reported and displayed to the user.

## User Management

To add user management, you should implement the following:

- Two additions are in the database for use with user management:

  1.  `entries` table:
      - `userId`: The user ID of the user who owns the entry
  1.  `users` table:
      - userId: The user's ID, auto-generated by PostgreSQL
      - username: The user's username
      - hashedPassword: The user's hashed password
      - createdAt: The timestamp when the user was created, auto-generated by PostgreSQL

- Copy freely from the user-management exercise.

- In the NavBar:

  - add a "Sign In" link if the user is not signed in
  - add a "Sign Out" link if the user is signed in
  - on sign in, route to `/auth/sign-in`, which displays the Auth page
  - on sign out, remove the token from storage and route to `/`

- Auth Page

  - display a Sign In page if the route is `/auth/sign-in`
  - display a Register page if the route is `/auth/sign-up`
  - display a link at the bottom of the page that routes to the other auth link (for example, "Register instead" links to `/auth/sign-up`)

- In `data.ts` get the JWT token from session (or local) storage and pass it in the `Authorization: Bearer` header.
- In `server.ts` use `authMiddleware` to make sure users don't access entries they do not own, using the `userId` in the JWT token.

# Tips!

- You will probably want a separate endpoint for each of the CRUD operations (Create/Read/Update/Delete) plus an additional one to get all the entries.
- It is usually best to test the endpoints with HTTPie before calling them from the frontend.
- Remember that the entry's `entryId` is auto-generated by PostgreSQL.
- To display the most recent entry first, think about sorting in the `SELECT` clause.
- Keeping all code that makes calls to the backend in `data.js` is probably a good idea.
- `useEffect` is a convenient way to read from the database every time a component is mounted.
- You will no longer need the local storage code or any event listeners.
